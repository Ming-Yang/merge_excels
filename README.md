# Excel/CSV 文件合并工具

一个基于 PySide6 开发的图形化 Excel/CSV 文件合并工具，支持批量合并多种格式的电子表格文件，具有智能表头检测、重复数据处理等实用功能。

## 📋 功能特性

### 核心功能

- **多格式支持**：支持 `.xlsx`、`.xls`、`.et`、`.csv` 等多种电子表格格式
- **批量处理**：支持多文件选择和文件夹批量导入，一次性处理大量文件
- **智能表头处理**：
  - 自动检测所有文件的表头一致性
  - 表头不一致时提供交互式选择界面
  - 自动对齐列，缺失列自动填充
- **重复数据处理**：自动检测完全重复的行，支持一键去重
- **多 Sheet 支持**：自动读取 Excel 文件中的所有工作表并合并
- **编码自动识别**：CSV 文件支持多种编码格式（UTF-8、GBK、GB2312 等）

### 用户体验

- **异步文件读取**：使用多线程技术，文件读取不阻塞界面，提升响应速度
- **实时状态显示**：显示每个文件的读取状态和行数统计
- **可视化界面**：现代化的图形界面，操作简单直观
- **详细统计信息**：显示合并前后的数据统计，包括文件数、行数等
- **灵活的文件管理**：支持删除选中的文件，随时调整待合并文件列表

### 输出功能

- **多格式保存**：支持保存为 Excel（.xlsx）或 CSV 格式
- **文件验证**：保存后自动验证文件完整性，确保数据安全

## 🚀 快速开始

### 环境要求

- Python 3.7 或更高版本
- Windows / Linux / macOS

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行程序

```bash
python main.py
```

## 📖 使用说明

### 基本操作流程

1. **选择文件**
   - 点击"选择文件"按钮，可多选要合并的文件
   - 或点击"选择路径"按钮，选择包含文件的文件夹（会自动识别文件夹下所有支持格式的文件）

2. **查看文件信息**
   - 文件列表会显示每个文件的文件名和行数
   - 正在读取的文件显示"-"，读取失败显示"失败"
   - 底部显示已选择文件数和总行数统计

3. **管理文件列表**
   - 选中一个或多个文件后，点击"删除选中"按钮可移除文件
   - 可以随时添加或删除文件，灵活调整待合并列表

4. **开始合并**
   - 点击"开始处理"按钮开始合并流程
   - 如果还有文件正在读取中，系统会提示等待

5. **处理表头**
   - 如果所有文件的表头一致，系统会自动使用该表头进行合并
   - 如果表头不一致，会弹出对话框让您选择要使用的表头
   - 系统会自动对齐列，缺失的列会填充为空值

6. **处理重复数据**
   - 如果检测到完全重复的行，系统会询问是否去重
   - 选择"是"将去除重复行，选择"否"将保留所有数据

7. **保存结果**
   - 选择保存位置和文件名
   - 选择保存格式（Excel 或 CSV）
   - 系统会验证文件保存是否成功

### 使用技巧

- **批量处理**：使用"选择路径"功能可以快速导入整个文件夹的文件
- **表头对齐**：即使表头不完全一致，系统也会自动对齐，只需选择目标表头即可
- **数据验证**：合并前可以查看每个文件的行数，确保数据正确
- **编码问题**：CSV 文件如果出现乱码，系统会自动尝试多种编码格式

## 🏗️ 项目结构

```
merge_excel_pyside6/
├── main.py                      # 主入口文件
├── requirements.txt             # 依赖包列表
├── README.md                    # 说明文档
├── core/                        # 核心业务逻辑模块
│   ├── __init__.py
│   ├── constants.py            # 常量定义（支持格式、编码等）
│   ├── file_reader.py          # 文件读取功能
│   └── data_merger.py          # 数据合并功能
└── ui/                          # 用户界面模块
    ├── __init__.py
    ├── main_window.py          # 主窗口界面
    └── header_selection_dialog.py  # 表头选择对话框
```

## 🛠️ 技术特点

- **模块化设计**：核心逻辑与 UI 完全分离，代码结构清晰，易于维护和扩展
- **异步处理**：使用 QThread 实现真正的多线程文件读取，提升用户体验
- **类型提示**：全面使用 Python 类型注解，提高代码可读性和可维护性
- **错误处理**：完善的异常处理机制，提供友好的错误提示
- **现代界面**：基于 PySide6 构建，界面美观现代，交互流畅

## 📝 注意事项

- 确保所有要合并的文件格式正确且可读
- 建议在合并前备份原始文件
- 大文件合并可能需要较长时间，请耐心等待
- 如果表头差异较大，建议先统一表头格式以获得最佳合并效果

## 🔄 版本说明

本版本使用 PySide6 重构，相比原版本具有以下优势：

- 更现代的图形界面框架
- 更好的代码组织和模块化设计
- 真正的异步文件读取，不会阻塞界面
- 更完善的类型提示和错误处理

## 📄 许可证

本项目采用 MIT 许可证。
